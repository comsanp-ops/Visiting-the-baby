<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ï‡πà‡∏á‡∏ï‡∏∂‡∏á‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÄ‡∏ï‡∏≤‡∏∞‡πÅ‡∏ï‡∏∞ - ‡∏≠‡∏ö‡∏ï.‡∏û‡∏•‡∏±‡∏ö‡∏û‡∏•‡∏≤‡πÑ‡∏ä‡∏¢</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Kanit -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet CSS & JS (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Kanit', 'sans-serif'] },
                    colors: { primary: '#ec4899', secondary: '#3b82f6', accent: '#eab308' }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #f3f4f6; }
        .sidebar { transition: width 0.3s ease, transform 0.3s ease; }
        .sidebar-text { transition: opacity 0.2s ease; white-space: nowrap; }
        .view-section { display: none; animation: fadeIn 0.4s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .form-input {
            width: 100%; padding: 0.5rem 0.75rem; border-radius: 0.5rem;
            border: 1px solid #d1d5db; outline: none; transition: border-color 0.2s;
        }
        .form-input:focus { border-color: #ec4899; box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.2); }
        
        #loading-overlay {
            position: fixed; inset: 0; background: rgba(255,255,255,0.8);
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .hidden-load { display: none !important; }
        
        /* ‡∏õ‡∏£‡∏±‡∏ö z-index ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏á header */
        .leaflet-container { z-index: 1 !important; font-family: 'Kanit', sans-serif;}
    </style>
</head>
<body class="overflow-hidden flex h-screen text-gray-800">

    <!-- üåü URL ‡∏Ç‡∏≠‡∏á Google Apps Script üåü -->
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwNtPvw2ruDo4-VULAto-7L3puz7fvfeXQhTJZuUvPll7iVMd-9UBn6q_-tryZcXXEl/exec"; // ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    </script>

    <!-- Loading -->
    <div id="loading-overlay" class="hidden-load">
        <i data-lucide="loader-2" class="w-12 h-12 text-pink-500 animate-spin mb-4"></i>
        <h3 class="text-lg font-bold text-gray-700" id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h3>
    </div>

    <!-- Sidebar & Header (Mobile Overlay) -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden" onclick="toggleMobileSidebar()"></div>

    <aside id="sidebar" class="sidebar bg-white w-64 h-full shadow-xl flex flex-col fixed lg:relative z-30 transform -translate-x-full lg:translate-x-0">
        <div class="h-16 flex items-center justify-center border-b px-4 mt-4 mb-4">
            <div class="sidebar-text text-center">
                <h1 class="font-bold text-primary leading-tight text-sm">‡∏≠‡∏ö‡∏ï.‡∏û‡∏•‡∏±‡∏ö‡∏û‡∏•‡∏≤‡πÑ‡∏ä‡∏¢</h1>
                <p class="text-xs text-gray-500">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÄ‡∏ï‡∏≤‡∏∞‡πÅ‡∏ï‡∏∞</p>
            </div>
        </div>
        <nav class="flex-1 px-3 py-4 space-y-2 overflow-y-auto">
            <button onclick="switchView('dashboard')" id="nav-dashboard" class="w-full flex items-center px-3 py-2.5 rounded-lg text-gray-600 hover:bg-pink-50 hover:text-primary transition-colors">
                <i data-lucide="layout-dashboard" class="w-5 h-5 flex-shrink-0"></i><span class="ml-3 sidebar-text font-medium">Dashboard</span>
            </button>
            <button onclick="switchView('form')" id="nav-form" class="w-full flex items-center px-3 py-2.5 rounded-lg text-gray-600 hover:bg-pink-50 hover:text-primary transition-colors">
                <i data-lucide="clipboard-plus" class="w-5 h-5 flex-shrink-0"></i><span class="ml-3 sidebar-text font-medium">‡πÅ‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ó‡∏≤‡∏£‡∏Å</span>
            </button>
            <button onclick="switchView('data')" id="nav-data" class="w-full flex items-center px-3 py-2.5 rounded-lg text-gray-600 hover:bg-pink-50 hover:text-primary transition-colors">
                <i data-lucide="database" class="w-5 h-5 flex-shrink-0"></i><span class="ml-3 sidebar-text font-medium">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ö‡πâ‡∏≤‡∏ô</span>
            </button>
        </nav>
        <div class="p-4 border-t hidden lg:flex">
            <button onclick="toggleSidebar()" class="w-full flex items-center justify-center p-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-600 transition">
                <i data-lucide="chevrons-left" id="toggle-icon" class="w-5 h-5"></i>
            </button>
        </div>
    </aside>

    <div class="flex-1 flex flex-col h-full overflow-hidden">
        <header class="h-16 bg-white shadow-sm flex items-center justify-between px-4 lg:px-6 z-10 relative">
            <div class="flex items-center">
                <button onclick="toggleMobileSidebar()" class="lg:hidden p-2 rounded-md text-gray-600 hover:bg-gray-100 focus:outline-none mr-2">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <h2 id="header-title" class="text-xl font-bold text-gray-800">Dashboard</h2>
            </div>
            <div class="flex items-center space-x-3">
                <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-1 rounded border border-blue-200 hidden sm:inline-block">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç</span>
                <div class="w-8 h-8 rounded-full bg-pink-200 flex items-center justify-center text-pink-700 font-bold">‡∏à‡∏ô</div>
            </div>
        </header>

        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-4 lg:p-6">
            
            <!-- üåü VIEW: DASHBOARD üåü -->
            <div id="view-dashboard" class="view-section active">
                
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 bg-white p-4 md:p-6 rounded-xl shadow-sm border-l-4 border-pink-500">
                    <div>
                        <h2 class="text-lg md:text-2xl font-bold text-gray-800">‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≥‡∏ö‡∏•‡∏û‡∏•‡∏±‡∏ö‡∏û‡∏•‡∏≤‡πÑ‡∏ä‡∏¢</h2>
                        <p class="text-sm md:text-base text-gray-500 mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ <span class="text-pink-600 font-semibold">"‡πÄ‡∏ï‡πà‡∏á‡∏ï‡∏∂‡∏á‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÄ‡∏ï‡∏≤‡∏∞‡πÅ‡∏ï‡∏∞"</span></p>
                    </div>
                </div>

                <!-- üåü ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Filters) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 14 ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô üåü -->
                <div class="bg-white p-4 rounded-xl shadow-sm mb-6">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center"><i data-lucide="filter" class="w-4 h-4 mr-2"></i> ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</label>
                            <select id="filterMoo" class="form-input text-sm" onchange="applyFilters()">
                                <option value="all">-- ‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô --</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 1">‡∏´‡∏°‡∏π‡πà 1</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 2">‡∏´‡∏°‡∏π‡πà 2</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 3">‡∏´‡∏°‡∏π‡πà 3</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 4">‡∏´‡∏°‡∏π‡πà 4</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 5">‡∏´‡∏°‡∏π‡πà 5</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 6">‡∏´‡∏°‡∏π‡πà 6</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 7">‡∏´‡∏°‡∏π‡πà 7</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 8">‡∏´‡∏°‡∏π‡πà 8</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 9">‡∏´‡∏°‡∏π‡πà 9</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 10">‡∏´‡∏°‡∏π‡πà 10</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 11">‡∏´‡∏°‡∏π‡πà 11</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 12">‡∏´‡∏°‡∏π‡πà 12</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 13">‡∏´‡∏°‡∏π‡πà 13</option>
                                <option value="‡∏´‡∏°‡∏π‡πà 14">‡∏´‡∏°‡∏π‡πà 14</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">‡πÄ‡∏û‡∏®</label>
                            <select id="filterGender" class="form-input text-sm" onchange="applyFilters()">
                                <option value="all">-- ‡∏ó‡∏∏‡∏Å‡πÄ‡∏û‡∏® --</option>
                                <option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option>
                                <option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</label>
                            <select id="filterGift" class="form-input text-sm" onchange="applyFilters()">
                                <option value="all">-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
                                <option value="‡∏°‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß">‡∏°‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß / ‡πÄ‡∏Ñ‡∏¢‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≠‡∏ö">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≠‡∏ö</option>
                            </select>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="resetFilters()" class="w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition">
                                ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤
                            </button>
                        </div>
                    </div>
                </div>

                <!-- üåü ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ 4 ‡∏Å‡∏•‡πà‡∏≠‡∏á üåü -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-sm p-4 border-l-4 border-pink-500 flex items-center">
                        <div class="bg-pink-100 p-3 rounded-lg text-pink-600 mr-4"><i data-lucide="baby" class="w-6 h-6"></i></div>
                        <div>
                            <p class="text-sm text-gray-500 font-medium">‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏£‡∏Å‡πÄ‡∏Å‡∏¥‡∏î (‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á)</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="stat-total">0 <span class="text-sm font-normal text-gray-500">‡∏Ñ‡∏ô</span></h3>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4 border-l-4 border-blue-500 flex items-center">
                        <div class="bg-blue-100 p-3 rounded-lg text-blue-600 mr-4"><i data-lucide="home" class="w-6 h-6"></i></div>
                        <div>
                            <p class="text-sm text-gray-500 font-medium">‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="stat-visited">0 <span class="text-sm font-normal text-gray-500">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span></h3>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4 border-l-4 border-yellow-500 flex items-center">
                        <div class="bg-yellow-100 p-3 rounded-lg text-yellow-600 mr-4"><i data-lucide="stethoscope" class="w-6 h-6"></i></div>
                        <div>
                            <p class="text-sm text-gray-500 font-medium">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="stat-care">0 <span class="text-sm font-normal text-gray-500">‡∏£‡∏≤‡∏¢</span></h3>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4 border-l-4 border-green-500 flex items-center">
                        <div class="bg-green-100 p-3 rounded-lg text-green-600 mr-4"><i data-lucide="gift" class="w-6 h-6"></i></div>
                        <div>
                            <p class="text-sm text-gray-500 font-medium">‡∏°‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÅ‡∏•‡πâ‡∏ß</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="stat-gift">0 <span class="text-sm font-normal text-gray-500">‡∏ä‡∏∏‡∏î</span></h3>
                        </div>
                    </div>
                </div>

                <!-- üåü ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ö‡πâ‡∏≤‡∏ô (Map) üåü -->
                <div class="bg-white rounded-xl shadow-sm p-5 mb-6 relative z-0">
                    <h3 class="font-bold text-gray-700 mb-4 flex items-center justify-center"><i data-lucide="map" class="w-5 h-5 mr-2 text-blue-500"></i> ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡πá‡∏Å‡∏ó‡∏≤‡∏£‡∏Å</h3>
                    <div id="map" class="h-96 w-full rounded-lg border border-gray-200 shadow-inner bg-gray-100"></div>
                </div>

                <!-- üåü ‡∏Å‡∏£‡∏≤‡∏ü (Charts) üåü -->
                <div class="bg-white rounded-xl shadow-sm p-5 mb-6">
                    <h3 class="font-bold text-gray-700 mb-4 text-center">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î (‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô / ‡∏õ‡∏µ)</h3>
                    <div class="relative h-72 w-full"><canvas id="lineChart"></canvas></div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-xl shadow-sm p-5">
                        <h3 class="font-bold text-gray-700 mb-4 text-center">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏£‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</h3>
                        <div class="relative h-64 w-full"><canvas id="barChart"></canvas></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-5">
                        <h3 class="font-bold text-gray-700 mb-4 text-center">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏®</h3>
                        <div class="relative h-64 w-full flex justify-center"><canvas id="pieChart"></canvas></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-5">
                        <h3 class="font-bold text-gray-700 mb-4 text-center">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°</h3>
                        <div class="relative h-64 w-full flex justify-center"><canvas id="feedingChart"></canvas></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-5">
                        <h3 class="font-bold text-gray-700 mb-4 text-center">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</h3>
                        <div class="relative h-64 w-full flex justify-center"><canvas id="healthChart"></canvas></div>
                    </div>
                </div>

            </div>

            <!-- VIEW: FORM -->
            <div id="view-form" class="view-section">
                <div class="max-w-3xl mx-auto bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="bg-gradient-to-r from-pink-500 to-pink-400 px-6 py-4">
                        <h2 class="text-white text-xl font-bold flex items-center"><i data-lucide="clipboard-list" class="w-6 h-6 mr-2"></i> ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°</h2>
                    </div>
                    <div class="p-6">
                        <form id="visitForm" onsubmit="submitForm(event)" class="space-y-6">
                            <!-- ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ -->
                            <div>
                                <h3 class="text-lg font-semibold border-b pb-2 mb-4 text-pink-600">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ö‡πâ‡∏≤‡∏ô *</label><input type="date" name="visitDate" required class="form-input"></div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà *</label>
                                        <select name="villageMoo" required class="form-input bg-white">
                                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô --</option>
                                            <option value="1">‡∏´‡∏°‡∏π‡πà 1</option><option value="2">‡∏´‡∏°‡∏π‡πà 2</option>
                                            <option value="3">‡∏´‡∏°‡∏π‡πà 3</option><option value="4">‡∏´‡∏°‡∏π‡πà 4</option>
                                            <option value="5">‡∏´‡∏°‡∏π‡πà 5</option><option value="6">‡∏´‡∏°‡∏π‡πà 6</option>
                                            <option value="7">‡∏´‡∏°‡∏π‡πà 7</option><option value="8">‡∏´‡∏°‡∏π‡πà 8</option>
                                            <option value="9">‡∏´‡∏°‡∏π‡πà 9</option><option value="10">‡∏´‡∏°‡∏π‡πà 10</option>
                                            <option value="11">‡∏´‡∏°‡∏π‡πà 11</option><option value="12">‡∏´‡∏°‡∏π‡πà 12</option>
                                            <option value="13">‡∏´‡∏°‡∏π‡πà 13</option><option value="14">‡∏´‡∏°‡∏π‡πà 14</option>
                                        </select>
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡πÄ‡∏î‡πá‡∏Å‡∏ó‡∏≤‡∏£‡∏Å *</label>
                                        <input list="childNameList" name="childName" id="childNameInput" required placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö ‡∏´‡∏£‡∏∑‡∏≠ ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•..." class="form-input bg-white" onchange="autoFillChildData()">
                                        <datalist id="childNameList">
                                            <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠..."></option>
                                        </datalist>
                                        <p class="text-xs text-pink-500 mt-1">* ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏¥‡∏™‡∏ï‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏´‡∏£‡∏∑‡∏≠ ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏î‡πá‡∏Å‡∏•‡∏á‡∏£‡∏∞‡∏ö‡∏ö</p>
                                    </div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏û‡∏® *</label><select name="gender" required class="form-input bg-white"><option value="">-- ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏û‡∏® --</option><option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option><option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option></select></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î *</label><input type="date" name="birthDate" required class="form-input"></div>
                                </div>
                            </div>
                            <!-- ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û -->
                            <div>
                                <h3 class="text-lg font-semibold border-b pb-2 mb-4 text-pink-600 mt-6">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°) *</label><input type="number" step="0.01" name="weight" required class="form-input"></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.) *</label><input type="number" step="0.1" name="height" required class="form-input"></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏° *</label><select name="feedingType" required class="form-input bg-white"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option><option value="‡∏ô‡∏°‡πÅ‡∏°‡πà">‡∏ô‡∏°‡πÅ‡∏°‡πà</option><option value="‡∏ô‡∏°‡∏ä‡∏á">‡∏ô‡∏°‡∏ä‡∏á</option><option value="‡∏ô‡∏°‡πÅ‡∏°‡πà+‡∏ô‡∏°‡∏ä‡∏á">‡∏ô‡∏°‡πÅ‡∏°‡πà+‡∏ô‡∏°‡∏ä‡∏á</option></select></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏≠‡∏î *</label><select name="deliveryMethod" required class="form-input bg-white"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option><option value="‡∏Ñ‡∏•‡∏≠‡∏î‡πÄ‡∏≠‡∏á">‡∏Ñ‡∏•‡∏≠‡∏î‡πÄ‡∏≠‡∏á</option><option value="‡∏ú‡πà‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î">‡∏ú‡πà‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î</option></select></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢ *</label><select name="excretion" required class="form-input bg-white"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option><option value="‡∏õ‡∏Å‡∏ï‡∏¥">‡∏õ‡∏Å‡∏ï‡∏¥</option><option value="‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥">‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</option></select></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô *</label><select name="vaccine" required class="form-input bg-white"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option><option value="‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î">‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î</option><option value="‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î">‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î</option></select></div>
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</label>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 bg-gray-50 p-3 rounded-lg border">
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="healthStatus" value="‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏î‡∏µ" class="rounded text-pink-500"> <span class="text-sm">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏ß‡∏±‡∏¢</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="healthStatus" value="‡∏ï‡∏±‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á" class="rounded text-pink-500"> <span class="text-sm">‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°)</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="healthStatus" value="‡∏™‡∏∞‡∏î‡∏∑‡∏≠‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö" class="rounded text-pink-500"> <span class="text-sm">‡∏™‡∏≤‡∏¢‡∏™‡∏∞‡∏î‡∏∑‡∏≠‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö/‡πÅ‡∏â‡∏∞</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="healthStatus" value="‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢" class="rounded text-pink-500"> <span class="text-sm">‡∏ó‡∏≤‡∏£‡∏Å‡∏î‡∏π‡∏î‡∏ô‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πà‡∏á</span></label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß -->
                            <div>
                                <h3 class="text-lg font-semibold border-b pb-2 mb-4 text-pink-600 mt-6">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏î‡∏π‡∏´‡∏•‡∏±‡∏Å *</label><input type="text" name="parentName" required class="form-input"></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="tel" name="phone" class="form-input"></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î (‡∏°‡∏≤‡∏£‡∏î‡∏≤)</label><input type="text" name="birthControl" class="form-input"></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏ö‡∏ä‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏±‡∏ç</label><select name="giftGiven" class="form-input bg-white"><option value="‡∏°‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß">‡∏°‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</option><option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≠‡∏ö">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≠‡∏ö</option><option value="‡πÄ‡∏Ñ‡∏¢‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß">‡πÄ‡∏Ñ‡∏¢‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</option></select></div>
                                    <div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label><textarea name="notes" rows="2" class="form-input resize-none"></textarea></div>
                                </div>
                            </div>
                            <!-- ‡∏û‡∏¥‡∏Å‡∏±‡∏î & ‡∏£‡∏π‡∏õ -->
                            <div>
                                <h3 class="text-lg font-semibold border-b pb-2 mb-4 text-pink-600 mt-6 flex items-center"><i data-lucide="map-pin" class="w-5 h-5 mr-2"></i> ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î, ‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î)</label>
                                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                                            <input type="text" id="gpsInput" name="gpsLocation" readonly placeholder="‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î..." class="form-input bg-gray-50 text-sm flex-1">
                                            <button type="button" onclick="getLocation()" class="px-4 py-2 bg-blue-100 text-blue-700 border border-blue-300 rounded-lg hover:bg-blue-200 flex items-center justify-center font-medium whitespace-nowrap transition">
                                                <i data-lucide="map" class="w-4 h-4 mr-2"></i> ‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                                            </button>
                                        </div>
                                    </div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏î‡πá‡∏Å‡∏ó‡∏≤‡∏£‡∏Å</label><input type="file" id="childPhoto" accept="image/*" class="w-full text-sm text-gray-500 border border-gray-200 rounded-lg p-1"></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-1">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏™‡∏†‡∏≤‡∏û‡∏ö‡πâ‡∏≤‡∏ô/‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</label><input type="file" id="housePhoto" accept="image/*" class="w-full text-sm text-gray-500 border border-gray-200 rounded-lg p-1"></div>
                                </div>
                            </div>
                            <div class="pt-6 flex justify-end space-x-3 border-t">
                                <button type="button" onclick="document.getElementById('visitForm').reset(); document.getElementById('gpsInput').value='';" class="px-5 py-2.5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
                                <button id="submitBtn" type="submit" class="px-6 py-2.5 bg-pink-600 text-white rounded-lg hover:bg-pink-700 font-medium flex items-center shadow-md"><i data-lucide="save" class="w-5 h-5 mr-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- VIEW: DATA -->
            <div id="view-data" class="view-section">
                <div class="bg-white rounded-xl shadow-sm overflow-hidden flex flex-col h-full">
                    <div class="px-6 py-4 border-b flex justify-between items-center bg-blue-50">
                        <h2 class="text-lg font-bold text-blue-800 flex items-center"><i data-lucide="table-properties" class="w-5 h-5 mr-2"></i>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                        <button onclick="fetchSheetData()" class="px-4 py-2 bg-white border border-blue-300 text-blue-600 rounded-lg hover:bg-blue-100 flex items-center text-sm font-medium"><i data-lucide="refresh-cw" class="w-4 h-4 mr-2" id="refresh-icon"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse whitespace-nowrap">
                            <thead>
                                <tr class="bg-gray-100 text-gray-600 text-sm uppercase tracking-wider">
                                    <th class="p-4 border-b">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°</th><th class="p-4 border-b">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏≤‡∏£‡∏Å</th><th class="p-4 border-b">‡∏´‡∏°‡∏π‡πà</th>
                                    <th class="p-4 border-b">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</th><th class="p-4 border-b">‡∏™‡∏∑‡πà‡∏≠</th><th class="p-4 border-b text-center">‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</th>
                                </tr>
                            </thead>
                            <tbody id="dataTableBody" class="text-sm divide-y divide-gray-100">
                                <tr><td colspan="6" class="text-center p-8 text-gray-500">‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="p-4 border-t text-sm text-gray-500"><span id="table-count-label">‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></div>
                </div>
            </div>

        </main>
    </div>

    <!-- Script Logic -->
    <script>
        lucide.createIcons();
        
        // Data Arrays
        let appData = [];        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Backend
        let filteredData = [];   // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß (‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü/‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà/‡∏ï‡∏≤‡∏£‡∏≤‡∏á)
        let childMasterList = [];

        // Charts & Map instances
        let barChartInst=null, pieChartInst=null, lineChartInst=null, feedingChartInst=null, healthChartInst=null;
        let map=null, markersGroup=null;

        // --- Sidebar & Views ---
        const sidebar = document.getElementById('sidebar'), overlay = document.getElementById('sidebar-overlay');
        let isCollapsed = false;
        function toggleSidebar() {
            isCollapsed = !isCollapsed;
            document.querySelectorAll('.sidebar-text').forEach(t => isCollapsed ? t.classList.add('hidden') : setTimeout(()=>t.classList.remove('hidden'),150));
            sidebar.classList.toggle('w-64'); sidebar.classList.toggle('w-20');
            document.getElementById('toggle-icon').setAttribute('data-lucide', isCollapsed ? 'chevrons-right' : 'chevrons-left');
            lucide.createIcons();
        }
        function toggleMobileSidebar() { sidebar.classList.toggle('-translate-x-full'); overlay.classList.toggle('hidden'); }
        
        const views = ['dashboard', 'form', 'data'];
        function switchView(targetView) {
            views.forEach(v => {
                document.getElementById(`view-${v}`).classList.remove('active');
                document.getElementById(`nav-${v}`).classList.remove('bg-pink-100', 'text-primary', 'font-semibold');
                document.getElementById(`nav-${v}`).classList.add('text-gray-600');
            });
            document.getElementById(`view-${targetView}`).classList.add('active');
            document.getElementById(`nav-${targetView}`).classList.add('bg-pink-100', 'text-primary', 'font-semibold');
            document.getElementById('header-title').innerText = { 'dashboard':'Dashboard', 'form':'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'data':'‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' }[targetView];
            if(window.innerWidth < 1024) { sidebar.classList.add('-translate-x-full'); overlay.classList.add('hidden'); }
            
            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Dashboard (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡∏Ñ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏≤)
            if(targetView === 'dashboard' && map) setTimeout(() => map.invalidateSize(), 100);
        }

        // ==========================================
        // üåü Map Initialization & Logic (Leaflet)
        // ==========================================
        function initMap() {
            if(!map) {
                // ‡∏ï‡∏±‡πâ‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏≠‡∏ö‡∏ï.‡∏û‡∏•‡∏±‡∏ö‡∏û‡∏•‡∏≤‡πÑ‡∏ä‡∏¢)
                map = L.map('map').setView([14.8, 99.8], 11); 
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap contributors'
                }).addTo(map);
                markersGroup = L.layerGroup().addTo(map);
            }
        }

        function updateMap() {
            if(!map) initMap();
            markersGroup.clearLayers();
            
            let bounds = [];
            filteredData.forEach(row => {
                let gps = row['‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ö‡πâ‡∏≤‡∏ô'];
                if(gps && typeof gps === 'string' && gps.includes(',')) {
                    let coords = gps.split(',');
                    let lat = parseFloat(coords[0].trim());
                    let lng = parseFloat(coords[1].trim());
                    
                    if(!isNaN(lat) && !isNaN(lng)) {
                        let health = row['‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô'] || '-';
                        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
                        let healthColor = health.includes('‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á') ? 'text-green-600' : 'text-orange-600';
                        
                        // üåü ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û üåü
                        let popupHTML = `
                            <div class="font-sans" style="min-width: 260px;">
                                <!-- ‡∏´‡∏±‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î -->
                                <div class="border-b border-gray-200 pb-2 mb-2">
                                    <h4 class="font-bold text-pink-600 text-base m-0 leading-tight">${row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏î‡πá‡∏Å'] || '-'}</h4>
                                    <span class="text-xs text-gray-500">${row['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô'] || '-'}</span>
                                </div>
                                
                                <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå) -->
                                <div class="flex gap-2 mb-3">
                                    ${row['‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå(‡πÄ‡∏î‡πá‡∏Å)'] ? `<div class="flex-1 text-center"><img src="${row['‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå(‡πÄ‡∏î‡πá‡∏Å)']}" class="w-full h-24 object-cover rounded shadow-sm border border-gray-100 cursor-pointer hover:opacity-80 transition" onclick="window.open('${row['‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå(‡πÄ‡∏î‡πá‡∏Å)']}')" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÄ‡∏ï‡πá‡∏°" alt="‡πÄ‡∏î‡πá‡∏Å"><span class="text-[10px] text-gray-400">üë∂ ‡∏ó‡∏≤‡∏£‡∏Å</span></div>` : ''}
                                    ${row['‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå(‡∏ö‡πâ‡∏≤‡∏ô)'] ? `<div class="flex-1 text-center"><img src="${row['‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå(‡∏ö‡πâ‡∏≤‡∏ô)']}" class="w-full h-24 object-cover rounded shadow-sm border border-gray-100 cursor-pointer hover:opacity-80 transition" onclick="window.open('${row['‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå(‡∏ö‡πâ‡∏≤‡∏ô)']}')" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÄ‡∏ï‡πá‡∏°" alt="‡∏ö‡πâ‡∏≤‡∏ô"><span class="text-[10px] text-gray-400">üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</span></div>` : ''}
                                </div>

                                <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å -->
                                <div class="grid grid-cols-2 gap-1 text-xs text-gray-700 mb-2">
                                    <div><span class="text-gray-400">‡πÄ‡∏û‡∏®:</span> ${row['‡πÄ‡∏û‡∏®'] || '-'}</div>
                                    <div><span class="text-gray-400">‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô:</span> ${row['‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô'] || '-'}</div>
                                    <div><span class="text-gray-400">‡∏ô.‡∏ô.:</span> ${row['‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å(‡∏Å‡∏Å.)'] || '-'} ‡∏Å‡∏Å.</div>
                                    <div><span class="text-gray-400">‡∏™.‡∏™.:</span> ${row['‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á(‡∏ã‡∏°.)'] || '-'} ‡∏ã‡∏°.</div>
                                    <div class="col-span-2"><span class="text-gray-400">‡∏ô‡∏°:</span> ${row['‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°'] || '-'}</div>
                                </div>

                                <!-- ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• -->
                                <div class="bg-gray-50 p-2 rounded border border-gray-100 text-xs mb-2">
                                    <div class="mb-1"><span class="text-gray-500">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û:</span> <span class="font-semibold ${healthColor}">${health}</span></div>
                                    <div><span class="text-gray-500">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•:</span> ${row['‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á'] || '-'} ${row['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£'] ? `(${row['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£']})` : ''}</div>
                                </div>
                                
                                <!-- ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) -->
                                ${row['‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏'] ? `<div class="text-[11px] text-gray-500 italic bg-pink-50 p-1.5 rounded border border-pink-100" title="${row['‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏']}">${row['‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏']}</div>` : ''}
                            </div>
                        `;
                        
                        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Popup ‡πÉ‡∏´‡πâ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                        let marker = L.marker([lat, lng]).bindPopup(popupHTML, { maxWidth: 320, minWidth: 280 });
                        markersGroup.addLayer(marker);
                        bounds.push([lat, lng]);
                    }
                }
            });

            // ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏°‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            if(bounds.length > 0) {
                map.fitBounds(bounds, { padding: [30, 30] });
            } else {
                map.setView([14.8, 99.8], 11); // ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            }
        }

        function getLocation() {
            const gpsInput = document.getElementById('gpsInput');
            gpsInput.value = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î...";
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    pos => gpsInput.value = `${pos.coords.latitude}, ${pos.coords.longitude}`,
                    err => { alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏õ‡∏¥‡∏î GPS/Location ‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì'); gpsInput.value = ""; },
                    { enableHighAccuracy: true }
                );
            } else { alert("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö GPS"); gpsInput.value = ""; }
        }

        // ==========================================
        // üåü Data Fetch & Filtering Logic
        // ==========================================
        async function fetchSheetData() {
            if(!GAS_URL) { document.getElementById('loading-overlay').classList.add('hidden-load'); return; }
            document.getElementById('loading-overlay').classList.remove('hidden-load');
            try {
                const res = await fetch(GAS_URL);
                const json = await res.json();
                if(json.status === 'success') {
                    appData = json.data; childMasterList = json.childList || [];
                    populateChildDropdown();
                    applyFilters(); // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Dashboard
                }
            } catch (err) { console.error('Fetch Error:', err); } 
            finally { document.getElementById('loading-overlay').classList.add('hidden-load'); }
        }

        function resetFilters() {
            document.getElementById('filterMoo').value = 'all';
            document.getElementById('filterGender').value = 'all';
            document.getElementById('filterGift').value = 'all';
            applyFilters();
        }

        function applyFilters() {
            const fMoo = document.getElementById('filterMoo').value;
            const fGen = document.getElementById('filterGender').value;
            const fGift = document.getElementById('filterGift').value;

            // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
            filteredData = appData.filter(row => {
                let matchMoo = fMoo === 'all' || (row['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô'] && row['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô'].toString().includes(fMoo));
                let matchGen = fGen === 'all' || (row['‡πÄ‡∏û‡∏®'] && row['‡πÄ‡∏û‡∏®'].toString() === fGen);
                
                let giftStat = (row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç'] || '').toString();
                let matchGift = true;
                if(fGift === '‡∏°‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß') matchGift = giftStat.includes('‡∏°‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß') || giftStat.includes('‡πÄ‡∏Ñ‡∏¢‡∏£‡∏±‡∏ö');
                if(fGift === '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≠‡∏ö') matchGift = giftStat.includes('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≠‡∏ö');

                return matchMoo && matchGen && matchGift;
            });

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á
            updateDashboardStats();
            updateCharts();
            updateMap();
            updateTable();
        }

        // ==========================================
        // üåü Update Dashboard Stats & Charts
        // ==========================================
        function updateDashboardStats() {
            let total = filteredData.length, needCare = 0, giftGiven = 0;
            filteredData.forEach(row => {
                let h = (row['‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô'] || '').toString();
                if(h && h !== '‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏î‡∏µ' && h !== '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏') needCare++;
                let g = (row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç'] || '').toString();
                if(g.includes('‡∏°‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß') || g.includes('‡πÄ‡∏Ñ‡∏¢‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß')) giftGiven++;
            });
            document.getElementById('stat-total').innerHTML = `${total} <span class="text-sm">‡∏Ñ‡∏ô</span>`;
            document.getElementById('stat-visited').innerHTML = `${total} <span class="text-sm">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>`;
            document.getElementById('stat-care').innerHTML = `${needCare} <span class="text-sm">‡∏£‡∏≤‡∏¢</span>`;
            document.getElementById('stat-gift').innerHTML = `${giftGiven} <span class="text-sm">‡∏ä‡∏∏‡∏î</span>`;
        }

        function updateCharts() {
            // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö 14 ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô
            const mooCounts = {'‡∏´‡∏°‡∏π‡πà 1':0, '‡∏´‡∏°‡∏π‡πà 2':0, '‡∏´‡∏°‡∏π‡πà 3':0, '‡∏´‡∏°‡∏π‡πà 4':0, '‡∏´‡∏°‡∏π‡πà 5':0, '‡∏´‡∏°‡∏π‡πà 6':0, '‡∏´‡∏°‡∏π‡πà 7':0, '‡∏´‡∏°‡∏π‡πà 8':0, '‡∏´‡∏°‡∏π‡πà 9':0, '‡∏´‡∏°‡∏π‡πà 10':0, '‡∏´‡∏°‡∏π‡πà 11':0, '‡∏´‡∏°‡∏π‡πà 12':0, '‡∏´‡∏°‡∏π‡πà 13':0, '‡∏´‡∏°‡∏π‡πà 14':0};
            const genderCounts = {'‡∏ä‡∏≤‡∏¢':0, '‡∏´‡∏ç‡∏¥‡∏á':0};
            const feedCounts = {'‡∏ô‡∏°‡πÅ‡∏°‡πà':0, '‡∏ô‡∏°‡∏ä‡∏á':0, '‡∏ô‡∏°‡πÅ‡∏°‡πà+‡∏ô‡∏°‡∏ä‡∏á':0};
            const healthCounts = {'‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏î‡∏µ':0, '‡∏ï‡∏±‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á':0, '‡∏™‡∏∞‡∏î‡∏∑‡∏≠‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö':0, '‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢':0, '‡∏≠‡∏∑‡πà‡∏ô‡πÜ':0};
            const birthTrends = {};

            filteredData.forEach(row => {
                let moo = row['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô'] ? row['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô'].toString().trim() : ''; if(mooCounts[moo] !== undefined) mooCounts[moo]++;
                let gen = row['‡πÄ‡∏û‡∏®'] ? row['‡πÄ‡∏û‡∏®'].toString().trim() : ''; if(genderCounts[gen] !== undefined) genderCounts[gen]++;
                
                let feed = row['‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°'] ? row['‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°'].toString().trim() : '';
                if(feedCounts[feed] !== undefined) feedCounts[feed]++;

                let health = row['‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô'] ? row['‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô'].toString() : '';
                if(health.includes('‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á')) healthCounts['‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏î‡∏µ']++;
                else {
                    let hasIssue = false;
                    if(health.includes('‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á')) { healthCounts['‡∏ï‡∏±‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á']++; hasIssue=true;}
                    if(health.includes('‡∏™‡∏∞‡∏î‡∏∑‡∏≠')) { healthCounts['‡∏™‡∏∞‡∏î‡∏∑‡∏≠‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö']++; hasIssue=true;}
                    if(health.includes('‡∏ô‡∏°')) { healthCounts['‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢']++; hasIssue=true;}
                    if(!hasIssue && health !== '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏') healthCounts['‡∏≠‡∏∑‡πà‡∏ô‡πÜ']++;
                }

                let bDateStr = row['‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î'];
                if(bDateStr) {
                    let d = new Date(bDateStr);
                    if(!isNaN(d)) {
                        let ym = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
                        birthTrends[ym] = (birthTrends[ym] || 0) + 1;
                    }
                }
            });

            [barChartInst, pieChartInst, lineChartInst, feedingChartInst, healthChartInst].forEach(c => { if(c) c.destroy(); });

            barChartInst = new Chart(document.getElementById('barChart'), {
                type: 'bar', data: { labels: Object.keys(mooCounts), datasets: [{ data: Object.values(mooCounts), backgroundColor: '#FFA6C9', borderRadius: 6 }] },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

            pieChartInst = new Chart(document.getElementById('pieChart'), {
                type: 'doughnut', data: { labels: ['‡∏ä‡∏≤‡∏¢', '‡∏´‡∏ç‡∏¥‡∏á'], datasets: [{ data: [genderCounts['‡∏ä‡∏≤‡∏¢'], genderCounts['‡∏´‡∏ç‡∏¥‡∏á']], backgroundColor: ['#89CFF0', '#FFA6C9'], borderWidth: 0 }] },
                options: { maintainAspectRatio: false }
            });

            const sortedMonths = Object.keys(birthTrends).sort();
            const thaiMonths = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
            const labelsLine = sortedMonths.map(ym => { let [y, m] = ym.split('-'); return `${thaiMonths[parseInt(m)-1]} ${(parseInt(y)+543).toString().substring(2)}`; });
            lineChartInst = new Chart(document.getElementById('lineChart'), {
                type: 'line', data: { labels: labelsLine, datasets: [{ label: '‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà', data: sortedMonths.map(ym => birthTrends[ym]), borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.2)', borderWidth: 3, fill: true, tension: 0.3 }] },
                options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
            });

            feedingChartInst = new Chart(document.getElementById('feedingChart'), {
                type: 'pie', data: { labels: Object.keys(feedCounts), datasets: [{ data: Object.values(feedCounts), backgroundColor: ['#fbcfe8', '#bfdbfe', '#fde047'], borderWidth: 1 }] },
                options: { maintainAspectRatio: false }
            });

            healthChartInst = new Chart(document.getElementById('healthChart'), {
                type: 'bar', data: { labels: Object.keys(healthCounts), datasets: [{ label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏£‡∏≤‡∏¢)', data: Object.values(healthCounts), backgroundColor: ['#4ade80', '#fbbf24', '#f87171', '#c084fc', '#9ca3af'], borderRadius: 4 }] },
                options: { maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } } }
            });
        }

        // ==========================================
        // üåü Update Table
        // ==========================================
        function updateTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            if(filteredData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="text-center p-8 text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á</td></tr>`;
            } else {
                [...filteredData].reverse().forEach(row => {
                    let vDate = row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ö‡πâ‡∏≤‡∏ô'] ? new Date(row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ö‡πâ‡∏≤‡∏ô']).toLocaleDateString('th-TH') : '-';
                    let healthClass = (row['‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô']||'').includes('‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á') ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700';
                    let giftClass = (row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç']||'').includes('‡∏°‡∏≠‡∏ö') ? 'text-green-500' : 'text-orange-500';
                    
                    let mediaLinks = '';
                    if(row['‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ö‡πâ‡∏≤‡∏ô']) mediaLinks += `<a href="https://maps.google.com/?q=${row['‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ö‡πâ‡∏≤‡∏ô']}" target="_blank" class="text-blue-500 hover:underline mr-2 text-xs">üìç ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a>`;
                    if(row['‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå(‡πÄ‡∏î‡πá‡∏Å)']) mediaLinks += `<a href="${row['‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå(‡πÄ‡∏î‡πá‡∏Å)']}" target="_blank" class="text-pink-500 hover:underline mr-2 text-xs">üë∂ ‡∏£‡∏π‡∏õ‡πÄ‡∏î‡πá‡∏Å</a>`;
                    if(row['‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå(‡∏ö‡πâ‡∏≤‡∏ô)']) mediaLinks += `<a href="${row['‡∏£‡∏π‡∏õ‡∏•‡∏¥‡∏á‡∏Å‡πå(‡∏ö‡πâ‡∏≤‡∏ô)']}" target="_blank" class="text-blue-600 hover:underline text-xs">üè† ‡∏£‡∏π‡∏õ‡∏ö‡πâ‡∏≤‡∏ô</a>`;
                    
                    let tr = document.createElement('tr'); tr.className = "hover:bg-gray-50";
                    tr.innerHTML = `
                        <td class="p-4 text-gray-500">${vDate}</td>
                        <td class="p-4 font-medium text-gray-800">${row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏î‡πá‡∏Å'] || '-'}</td>
                        <td class="p-4">${row['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô'] || '-'}</td>
                        <td class="p-4"><span class="${healthClass} px-2 py-1 rounded text-xs">${row['‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô']||'-'}</span></td>
                        <td class="p-4">${mediaLinks||'-'}</td>
                        <td class="p-4 text-center"><span class="${giftClass} font-medium">${row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç']||'-'}</span></td>
                    `;
                    tbody.appendChild(tr);
                });
            }
            document.getElementById('table-count-label').innerText = `‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${filteredData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
        }

        // ==========================================
        // üåü Form Submissions (Image Upload & Auto-fill)
        // ==========================================
        function populateChildDropdown() {
            const datalist = document.getElementById('childNameList');
            if (!datalist) return;
            datalist.innerHTML = '';
            
            // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡πá‡∏Å‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á Master List ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            let names = new Set();
            childMasterList.forEach(child => { if(child['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏î‡πá‡∏Å']) names.add(child['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏î‡πá‡∏Å']); });
            appData.forEach(row => { if(row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏î‡πá‡∏Å']) names.add(row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏î‡πá‡∏Å']); });

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Dropdown
            names.forEach(name => {
                let opt = document.createElement('option');
                opt.value = name;
                datalist.appendChild(opt);
            });
        }

        function autoFillChildData() {
            const input = document.getElementById('childNameInput');
            const selectedName = input.value.trim();
            if(!selectedName) return;

            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡πá‡∏Å‡∏ó‡∏≤‡∏£‡∏Å
            let childBaseline = childMasterList.find(c => c['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏î‡πá‡∏Å'] === selectedName);
            
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏ô appData
            let latestVisit = null;
            const childVisits = appData.filter(row => row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏î‡πá‡∏Å'] === selectedName);
            if(childVisits.length > 0) {
                latestVisit = childVisits[childVisits.length - 1]; // ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
            }

            // 1. ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß
            if (childBaseline || latestVisit) {
                let genderVal = (childBaseline && childBaseline['‡πÄ‡∏û‡∏®']) || (latestVisit && latestVisit['‡πÄ‡∏û‡∏®']) || '';
                if(genderVal) document.querySelector('select[name="gender"]').value = genderVal;
                
                let bDate = (childBaseline && childBaseline['‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î']) || (latestVisit && latestVisit['‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î']) || '';
                if(bDate) {
                    let d = new Date(bDate);
                    if(!isNaN(d)) document.querySelector('input[name="birthDate"]').value = d.toISOString().split('T')[0];
                }
                
                let parentVal = (childBaseline && childBaseline['‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á']) || (latestVisit && latestVisit['‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á']) || '';
                if(parentVal) document.querySelector('input[name="parentName"]').value = parentVal;

                let phoneVal = (childBaseline && childBaseline['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£']) || (latestVisit && latestVisit['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£']) || '';
                if(phoneVal) document.querySelector('input[name="phone"]').value = phoneVal;
            }

            // 2. ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
            if(latestVisit) {
                if(latestVisit['‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å(‡∏Å‡∏Å.)']) document.querySelector('input[name="weight"]').value = latestVisit['‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å(‡∏Å‡∏Å.)'];
                if(latestVisit['‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á(‡∏ã‡∏°.)']) document.querySelector('input[name="height"]').value = latestVisit['‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á(‡∏ã‡∏°.)'];
                if(latestVisit['‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°']) document.querySelector('select[name="feedingType"]').value = latestVisit['‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°'];
                if(latestVisit['‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏≠‡∏î']) document.querySelector('select[name="deliveryMethod"]').value = latestVisit['‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏≠‡∏î'];
                if(latestVisit['‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢']) document.querySelector('select[name="excretion"]').value = latestVisit['‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢'];
                if(latestVisit['‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô']) document.querySelector('select[name="vaccine"]').value = latestVisit['‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô'];
                if(latestVisit['‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î(‡∏°‡∏≤‡∏£‡∏î‡∏≤)']) document.querySelector('input[name="birthControl"]').value = latestVisit['‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î(‡∏°‡∏≤‡∏£‡∏î‡∏≤)'];
            }
        }

        function resizeAndGetBase64(file) {
            return new Promise((resolve, reject) => {
                if (!file) { resolve(""); return; }
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image(); img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 800; const scale = MAX_WIDTH / img.width;
                        canvas.width = MAX_WIDTH; canvas.height = img.height * scale;
                        const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7).split(',')[1]);
                    };
                };
                reader.onerror = error => reject(error);
            });
        }

        async function submitForm(event) {
            event.preventDefault();
            const form = event.target; const formData = new FormData(form);
            const dataObj = Object.fromEntries(formData.entries());
            dataObj.healthStatus = formData.getAll('healthStatus').join(', ') || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏';

            if (!GAS_URL) { alert('‚ö†Ô∏è ‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà GAS_URL ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'); return; }

            document.getElementById('loading-text').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
            document.getElementById('loading-overlay').classList.remove('hidden-load');

            try {
                const fChild = document.getElementById('childPhoto').files[0];
                const fHouse = document.getElementById('housePhoto').files[0];
                dataObj.childPhotoBase64 = fChild ? await resizeAndGetBase64(fChild) : "";
                dataObj.housePhotoBase64 = fHouse ? await resizeAndGetBase64(fHouse) : "";

                const response = await fetch(GAS_URL, {
                    method: 'POST', headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(dataObj)
                });
                const result = await response.json();
                if(result.status === 'success') {
                    alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                    form.reset(); document.getElementById('gpsInput').value = '';
                    switchView('data'); fetchSheetData();
                } else { alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.message); }
            } catch (error) { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠'); } 
            finally { 
                document.getElementById('loading-overlay').classList.add('hidden-load'); 
                document.getElementById('loading-text').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
            }
        }

        // ==========================================
        // üåü Initializer
        // ==========================================
        window.onload = () => { 
            initMap(); 
            switchView('dashboard'); 
            fetchSheetData(); 
        };
    </script>
</body>
</html>
